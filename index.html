<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>LF & LM</title>

<!-- iOS PWA support -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="LF&LM">

<link rel="apple-touch-icon" href="icon.png">
<link rel="manifest" href="manifest.json">

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: black;
  font-family: 'Courier New', monospace;
  touch-action: manipulation;
}

canvas {
  display: block;
  width: 100%;
  height: 100%;
}

.center-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: #d36fff;
  font-size: clamp(14px, 5vw, 28px);
  letter-spacing: 0.15em;
  font-weight: 800;
  padding: 4px 12px;
  border-radius: 12px;
  background: rgba(0,0,0,0.35);
  text-shadow:
    0 0 8px #b066ff,
    0 0 16px #d36fff,
    0 0 24px #a25fff,
    0 0 32px #ffb3ff;
  pointer-events: none;
}
</style>
</head>

<body>
<canvas id="canvas"></canvas>
<div class="center-text" id="centerText">LF ‚ù§ LM</div>

<script>
window.onload = () => {

  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const centerText = document.getElementById('centerText');

  const BPM = 72;
  const beatInterval = 60000 / BPM;
  const letters = ['L','O','V','E'];
  let fontSize = 36;

  let columns, rows;
  let grid = [];
  let columnsData = [];
  let lastBeat = 0;
  let pulsePhase = 0;
  let ecgX = 0;

  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  let audioUnlocked = false;

  let heartParticles = [];
  let heartTrailParticles = [];
  let heartScale, heartCenterX, heartCenterY;

  // ===== INVISIBLE AUDIO UNLOCK (iOS FIX) =====
  function unlockAudio() {
    if (!audioUnlocked) {
      audioCtx.resume();
      audioUnlocked = true;
      window.removeEventListener('touchstart', unlockAudio);
      window.removeEventListener('click', unlockAudio);
    }
  }
  window.addEventListener('touchstart', unlockAudio, { passive: true });
  window.addEventListener('click', unlockAudio);

  // ===================== RESIZE =====================
  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    fontSize = Math.max(12, Math.min(36, canvas.width / 30));
    columns = Math.floor(canvas.width / fontSize);
    rows = Math.floor(canvas.height / fontSize);

    grid = Array(rows).fill(0).map((_, r) =>
      Array(columns).fill(0).map((_, c) => letters[(r + c) % letters.length])
    );

    columnsData = Array(columns).fill(0).map(() => ({
      pos: Math.random() * rows,
      speed: 0.03 + Math.random() * 0.07,
      trail: 2 + Math.floor(Math.random() * 3)
    }));

    const scaleX = canvas.width / 32 * 0.45;
    const scaleY = canvas.height / 30 * 0.45;
    heartScale = Math.min(scaleX, scaleY);

    heartCenterX = canvas.width / 2;
    heartCenterY = canvas.height / 2 + 5;

    heartParticles = [];
    heartTrailParticles = [];

    for (let i = 0; i < Math.min(1500, window.innerWidth * 0.5); i++) {
      let t = Math.random() * Math.PI * 2;
      let r = Math.random();
      let swirl = Math.random() * 0.02 - 0.01;

      let x0 = 16 * Math.pow(Math.sin(t), 3) * r * heartScale;
      let y0 = -(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t)) * r * heartScale;

      heartParticles.push({
        t, r, swirl,
        baseSize: Math.random() * 2 + 1,
        alpha: Math.random() * 0.7 + 0.3,
        speed: 0.002 + Math.random() * 0.003,
        colorOffset: Math.random() * 50,
        x: heartCenterX + x0,
        y: heartCenterY + y0
      });

      heartTrailParticles.push({
        x: heartCenterX + x0,
        y: heartCenterY + y0,
        size: Math.random() * 3 + 0.5,
        alpha: Math.random() * 0.2 + 0.05
      });
    }
  }

  window.addEventListener('resize', resize);
  resize();

  // ===================== MATRIX =====================
  function drawMatrix() {
    ctx.fillStyle = 'rgba(0,0,0,0.05)';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.font = fontSize + 'px monospace';
    ctx.textBaseline = 'top';

    for (let c = 0; c < columns; c++) {
      let col = columnsData[c];
      for (let t = 0; t < col.trail; t++) {
        let r = Math.floor(col.pos - t);
        if (r < 0) r += rows;
        ctx.globalAlpha = (1 - t / col.trail) * 0.8;
        ctx.fillStyle = `rgba(180,90,255,1)`;
        ctx.fillText(grid[r][c], c * fontSize, r * fontSize);
      }
      col.pos += col.speed;
      if (col.pos >= rows) col.pos = 0;
    }
    ctx.globalAlpha = 1;
  }

  // ===================== HEART =====================
  function drawHeart() {
    let pulse = pulsePhase < 0.2
      ? 1 + 0.3 * Math.sin(pulsePhase / 0.2 * Math.PI)
      : 1;

    centerText.style.transform =
      `translate(-50%, -50%) scale(${1 + 0.15 * pulse})`;

    ctx.save();
    ctx.globalCompositeOperation = 'lighter';

    heartParticles.forEach((p,i) => {
      p.t += p.speed + p.swirl;

      let x = 16*Math.pow(Math.sin(p.t),3)*p.r*heartScale*pulse;
      let y = -(13*Math.cos(p.t)-5*Math.cos(2*p.t)-2*Math.cos(3*p.t)-Math.cos(4*p.t))
              *p.r*heartScale*pulse;

      p.x = heartCenterX + x;
      p.y = heartCenterY + y;

      ctx.globalAlpha = p.alpha;
      ctx.fillStyle = `rgba(200,100,255,1)`;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.baseSize, 0, Math.PI * 2);
      ctx.fill();
    });

    ctx.restore();
  }

  // ===================== ECG =====================
  function drawECG() {
    const y = canvas.height / 2;
    ctx.strokeStyle = '#a25fff';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(ecgX, y);
    ctx.lineTo(ecgX + 4, y - Math.sin(pulsePhase * Math.PI) * 30);
    ctx.stroke();
    ecgX = (ecgX + 5) % canvas.width;
  }

  // ===================== SOUND =====================
  function playBeat(delay=0){
    if (!audioUnlocked) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.frequency.value = 110;
    const t = audioCtx.currentTime + delay;
    gain.gain.setValueAtTime(0.001, t);
    gain.gain.exponentialRampToValueAtTime(0.4, t + 0.04);
    gain.gain.exponentialRampToValueAtTime(0.001, t + 0.18);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start(t);
    osc.stop(t + 0.2);
  }

  function playHeartbeat(){
    playBeat(0);
    playBeat(0.18);
  }

  // ===================== ANIMATION =====================
  function animate(time) {
    drawMatrix();
    pulsePhase = (time - lastBeat) / beatInterval;
    drawHeart();
    drawECG();

    if (time - lastBeat > beatInterval) {
      playHeartbeat();
      lastBeat = time;
    }

    requestAnimationFrame(animate);
  }

  animate(0);
};
</script>
</body>
</html>
