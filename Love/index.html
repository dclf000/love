<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>LF & LM</title>

<!-- iOS PWA support -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="LF&LM">

<!-- Favicon / Icon for iOS -->
<link rel="apple-touch-icon" href="icon.png">

<!-- Manifest for PWA -->
<link rel="manifest" href="manifest.json">

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: black;
  font-family: 'Courier New', monospace;
  touch-action: manipulation;
}

canvas { display: block; width: 100%; height: 100%; }

.center-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(1);
  color: #d36fff;
  font-size: clamp(14px, 5vw, 28px);
  letter-spacing: 0.15em;
  font-weight: 800;
  white-space: nowrap;
  text-align: center;
  pointer-events: none;
  padding: 4px 12px;
  border-radius: 12px;
  background: rgba(0,0,0,0.35);
  text-shadow: 
    0 0 8px #b066ff,
    0 0 16px #d36fff,
    0 0 24px #a25fff,
    0 0 32px #ffb3ff;
}
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<div class="center-text" id="centerText">LF ‚ù§ LM</div>

<script>
window.onload = () => {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const centerText = document.getElementById('centerText');

  const BPM = 72;
  const beatInterval = 60000 / BPM;
  const letters = ['L','O','V','E'];
  let fontSize = 36;

  let columns, rows;
  let grid = [];
  let columnsData = [];
  let lastBeat = 0;
  let pulsePhase = 0;
  let ecgX = 0;
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  let heartParticles = [];
  let heartTrailParticles = [];
  let heartScale, heartCenterX, heartCenterY;

  // ===================== RESIZE =====================
  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    fontSize = Math.max(12, Math.min(36, canvas.width / 30));
    columns = Math.floor(canvas.width / fontSize);
    rows = Math.floor(canvas.height / fontSize);

    grid = Array(rows).fill(0).map((_, r) =>
      Array(columns).fill(0).map((_, c) => letters[(r + c) % letters.length])
    );

    columnsData = Array(columns).fill(0).map(() => ({
      pos: Math.random() * rows,
      speed: 0.03 + Math.random() * 0.07,
      trail: 2 + Math.floor(Math.random() * 3)
    }));

    const heartWidthUnits = 32;
    const heartHeightUnits = 30;
    const scaleX = canvas.width / heartWidthUnits * 0.45;
    const scaleY = canvas.height / heartHeightUnits * 0.45;
    heartScale = Math.min(scaleX, scaleY);

    heartCenterX = canvas.width / 2;
    heartCenterY = canvas.height / 2 + 5;

    heartParticles = [];
    heartTrailParticles = [];
    for (let i = 0; i < Math.min(1500, window.innerWidth * 0.5); i++) {
      let t = Math.random() * Math.PI * 2;
      let r = Math.random();
      let swirl = Math.random() * 0.02 - 0.01;

      let x0 = 16 * Math.pow(Math.sin(t), 3) * r * heartScale;
      let y0 = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t)) * r * heartScale;
      y0 += heartCenterY;

      heartParticles.push({
        baseX: x0, baseY: y0, t, r, baseSize: Math.random() * 2 + 1,
        alpha: Math.random() * 0.7 + 0.3, speed: 0.002 + Math.random() * 0.003,
        swirl, colorOffset: Math.random() * 50, x: x0, y: y0
      });

      heartTrailParticles.push({
        x: heartCenterX + x0,
        y: heartCenterY + y0,
        size: Math.random() * 3 + 0.5,
        alpha: Math.random() * 0.25 + 0.05
      });
    }
  }

  window.addEventListener('resize', resize);
  resize();

  // ===================== MATRIX =====================
  function drawMatrix() {
    ctx.fillStyle = 'rgba(0,0,0,0.05)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.font = fontSize + 'px monospace';
    ctx.textAlign = 'left';
    ctx.textBaseline = 'top';
    ctx.shadowBlur = 0;

    for (let c = 0; c < columns; c++) {
      let col = columnsData[c];
      for (let t = 0; t < col.trail; t++) {
        let r = Math.floor(col.pos - t);
        if (r < 0) r += rows;
        ctx.globalAlpha = (1 - t / col.trail) * 0.8;

        let red = 180 + t * 5;
        let green = 90 + t * 3;
        let blue = 255 - t * 5;
        ctx.fillStyle = `rgba(${red|0},${green|0},${blue|0},1)`;

        ctx.fillText(grid[r][c], c * fontSize, r * fontSize);
      }
      col.pos += col.speed;
      if (col.pos >= rows) col.pos = 0;
    }
    ctx.globalAlpha = 1;
  }

  // ===================== HEART =====================
  function drawHeart() {
    let pulse = (pulsePhase < 0.2) ? 1 + 0.3 * Math.sin(pulsePhase / 0.2 * Math.PI) : 1;
    const shockwave = Math.sin(pulsePhase * Math.PI) * 3;

    centerText.style.transform = `translate(-50%, -50%) scale(${1 + 0.2 * pulse})`;

    ctx.save();
    ctx.globalCompositeOperation = 'lighter';

    heartTrailParticles.forEach(tp => {
      tp.alpha *= 0.92;
      tp.x += (Math.random() - 0.5) * 0.5;
      tp.y += (Math.random() - 0.5) * 0.5;
      ctx.globalAlpha = tp.alpha;
      ctx.fillStyle = `rgba(200,100,255,${tp.alpha})`;
      ctx.beginPath();
      ctx.arc(tp.x, tp.y, tp.size, 0, Math.PI * 2);
      ctx.fill();
    });

    heartParticles.forEach((p, i) => {
      p.t += p.speed + p.swirl;
      if (p.t > Math.PI * 2) p.t -= Math.PI * 2;

      let x0 = 16 * Math.pow(Math.sin(p.t), 3) * p.r * heartScale * pulse;
      let y0 = -(13 * Math.cos(p.t) - 5 * Math.cos(2 * p.t) - 2 * Math.cos(3 * p.t) - Math.cos(4 * p.t)) * p.r * heartScale * pulse;

      let angle = Math.atan2(y0, x0);
      let pulseOut = shockwave * Math.random();
      x0 += Math.cos(angle) * pulseOut;
      y0 += Math.sin(angle) * pulseOut;

      p.x = heartCenterX + x0;
      p.y = heartCenterY + y0;

      ctx.globalAlpha = p.alpha * (0.5 + 0.5 * pulse);

      let red = 200 + Math.sin(Date.now() * 0.002 + p.colorOffset) * 30;
      let green = 80 + Math.cos(Date.now() * 0.003 + p.colorOffset) * 50;
      let blue = 255 - Math.sin(Date.now() * 0.002 + p.colorOffset) * 20;
      ctx.fillStyle = `rgba(${red|0},${green|0},${blue|0},1)`;

      ctx.beginPath();
      ctx.arc(p.x, p.y, p.baseSize, 0, Math.PI * 2);
      ctx.fill();

      heartTrailParticles[i].x = p.x;
      heartTrailParticles[i].y = p.y;
      heartTrailParticles[i].alpha = 0.15 + Math.random() * 0.1;
    });

    ctx.globalCompositeOperation = 'source-over';
    ctx.restore();
  }

  // ===================== ECG =====================
  function drawECG() {
    const yBase = canvas.height / 2;
    ctx.strokeStyle = '#a25fff';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(ecgX, yBase);
    let offset = 0;
    if (pulsePhase < 0.12) offset = -50 + Math.random() * 4;
    else if (pulsePhase < 0.18) offset = 25 + Math.random() * 3;
    else if (pulsePhase < 0.3) offset = -20 + Math.random() * 2;
    ctx.lineTo(ecgX + 4, yBase + offset);
    ctx.stroke();
    ecgX += 5;
    if (ecgX > canvas.width) ecgX = 0;
  }

  // ===================== HEARTBEAT SOUND =====================
  function playBeat(delay = 0) {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.value = 110;
    const t = audioCtx.currentTime + delay;
    gain.gain.setValueAtTime(0.001, t);
    gain.gain.exponentialRampToValueAtTime(0.5, t + 0.04);
    gain.gain.exponentialRampToValueAtTime(0.001, t + 0.18);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start(t);
    osc.stop(t + 0.2);
  }

  function playHeartbeat() {
    playBeat(0);
    playBeat(0.18);
  }

  window.addEventListener('touchstart', () => audioCtx.resume(), { once: true });
  window.addEventListener('click', () => audioCtx.resume(), { once: true });

  // ===================== ANIMATION =====================
  function animate(time) {
    drawMatrix();
    const sinceLast = time - lastBeat;
    pulsePhase = sinceLast / beatInterval;

    drawHeart();
    drawECG();

    if (sinceLast > beatInterval) {
      playHeartbeat();
      lastBeat = time;
    }

    requestAnimationFrame(animate);
  }

  animate(0);
};
</script>
</body>
</html>
